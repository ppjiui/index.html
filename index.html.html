<!DOCTYPE html>
<html>
<head>
    <title>Printable Food Tags (9x6cm) - 8 per page</title>
    <style>
        @page { 
            size: A4; 
            margin: 0; 
        }
        body { 
            margin: 0; 
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .controls {
            padding: 10px;
            background: #f0f0f0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .pages-container {
            flex: 1;
            overflow-y: auto;
        }
        .page {
            width: 210mm;
            height: 297mm;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 5mm;
            padding: 10mm;
            box-sizing: border-box;
            background: #f9f9f9;
            margin: 10px auto;
            page-break-after: avoid;
            page-break-inside: avoid;
            overflow: hidden;
            position: relative;
        }
        .tag {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3mm;
            background: #F8F5F0;
            border: 2px solid #FFD700;
            box-shadow: 0 1mm 2mm rgba(0,0,0,0.05);
            border-radius: 0;
            width: 90mm;
            height: 60mm;
            page-break-inside: avoid;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tag:hover {
            background: #FFF0D0;
        }
        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .tag:hover .delete-btn {
            opacity: 1;
        }
        .logo {
            max-width: 80%;
            max-height: 12mm;
            margin-bottom: 2mm;
            object-fit: contain;
            pointer-events: none;
            user-select: none;
        }
        .food-name {
            font-size: 10mm;
            font-weight: bold;
            color: #222;
            text-align: center;
            margin: 2mm 0;
            text-transform: uppercase;
            word-break: break-word;
            width: 100%;
        }
        .accent-bar {
            width: 70%;
            height: 1.5mm;
            background: #FFD700;
            margin: 1mm 0;
            pointer-events: none;
            user-select: none;
        }
        button {
            padding: 8px 15px;
            background: #FFD700;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        input[type="range"] {
            width: 150px;
        }
        .size-display {
            min-width: 50px;
            display: inline-block;
            text-align: center;
        }
        .file-input {
            display: none;
        }
        .page-controls {
            text-align: center;
            padding: 10px;
            background: #e0e0e0;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.5s;
        }
        @media print {
            .controls, .page-controls, .delete-btn {
                display: none;
            }
            body {
                margin: 0;
                padding: 0;
                background: white;
            }
            .page {
                background: white;
                margin: 0;
                padding: 10mm;
                height: 297mm;
            }
            .tag {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                background: #F8F5F0 !important;
                border: 2px solid #FFD700 !important;
            }
            .accent-bar {
                background: #FFD700 !important;
            }
        }
    </style>
<link rel="icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAAM8AAABzBAMAAADNp0tiAAAAElBMVEW8j1NHcEwlHBBxVjEkHBCie0fOj2bZAAAABXRSTlP+AFXpnCkdkxwAAAOaSURBVGje7ZnLsqMgEECpstyP6A8AZu8V2U8w2VM38f9/ZXzE+GpEArKYSi+yUMKhnzSIkjDyB31BAUGUBAKxayhQGQh0eQYC/Y1IGFARhwHhIr4GAaUKlWFACFVBQBeEeBDQHaEHCQDCAqEoBCgrEPog7OxBbdCh+CcAiKFWylCgRwCQ6ED20WANwkUHso8Ga1AXCy2oPB3Uuwih5+kgMYCis0GDiz6IBltQpgaQdcragl4uQuj3ZJAYQdG5oNFF9k6yBakRZJuylqC3i6zr6gTCR2xxn0DPT0GZtHHRMSflBNKoIoezqBezkzCHQEld2rjoSCYxGMTMvU0xBxlth0UFRl3WlDaWMwd4qkoQhAvTGheWM9oOi/lS5nlUmLazYgkyrIupSAO6oMf1aHCbK3gmFg3tHJQaet2V5faLA+ZqcRaYg1pf7xlvrdC+7ZhaLmQOwvvNbqrQcZVawy3nWhTVbrPRGg+LDWdnMF+/XYB2u11AIb2l6+5tpd0m+rk0f4YU0qrExGbJC9Dg7kgeVUi3qkxso3+58Q1x9ZBHFYJVeo2NrnrQRftvpmBQXMGBsDlxLEHjdBtSplEIUP+te7kDepdnLgm0SEj4clE5H+f42QFNyd/w2UpxrdAxEmZT43fd64ImCzX8vbXjutjhtG6i48CcC12YrEDzuvngJSUkoTlHBnl0hsYLzKZLWoFSFU9Dm6bhrQhlAsX9ON40O3VwBcLGSY/KerNagwpfoFUsbFriuyd9Nqm4BjEU+0E9DU1+5slJm2q7Bvly0tpF22OL8AQiJhA7x0VbUOoHVBpBflJ220xtQeIUFwFnWC9OipJAoPIAKD2hooIgHykLNNbAPYNAyn8sQKDaXaPHoZsTdkYsQKDU1XIKOgoCIPdogL6YQZdOd//pCoPYCS4CQc5O+jkIcnUSeA4GLwYL7+mqAd1daoOCP8WAIKa8xwIMcuy5fg6D3KIB/sAN3xLX3CTVS6BXFiBKKcajeph2IuUtv/WS53Qmef56PEg7irrce+NOCMUUlhEzLMEFRFpIx5mT3lzZ6tEpI3sOIU43+YQMHALoI+Vg0UEfnLhqhAlsO5l3QuVLT5I4akR7GMagn+RkT/opCOsiYIy63m6zYLQBYXn7QOq6vlW32zXxmbA7UlqACu819QzQ73+n0RcUJBjucRPHSn3y08A7uQY07GVSI10B7X5WD4cnOXXbJpzlC/qCvqAvCAD9A6M7x+SW47sWAAAAAElFTkSuQmCC" type="image/x-icon">
</head>
<body>
    <div class="controls">
        <div class="control-group">
            <label>Tag Width:</label>
            <input type="range" id="width-control" min="50" max="120" value="90">
            <span class="size-display" id="width-display">90mm</span>
        </div>
        <div class="control-group">
            <label>Tag Height:</label>
            <input type="range" id="height-control" min="40" max="100" value="60">
            <span class="size-display" id="height-display">60mm</span>
        </div>
        <div class="control-group">
            <label>Font Size:</label>
            <input type="range" id="font-control" min="3" max="15" value="10">
            <span class="size-display" id="font-display">10mm</span>
        </div>
        <button onclick="resetSizes()">Reset Sizes</button>
        <button onclick="addNewPage()" style="cursor: pointer;">Add Page</button>
        <button onclick="removeCurrentPage()" style="cursor: pointer;">Remove Page</button>
        <button onclick="printTags()">Print Tags</button>
        <button onclick="exportToJson()">Save to JSON</button>
        <button onclick="document.getElementById('file-input').click()">Load from JSON</button>
        <input type="file" id="file-input" class="file-input" accept=".json" onchange="importFromJson(event)">
    </div>

    <div class="notification" id="notification">Tag deleted</div>

    <div class="pages-container" id="pages-container">
        <!-- Pages will be added here dynamically -->
    </div>

    <script>
        // Get controls
        const widthControl = document.getElementById('width-control');
        const heightControl = document.getElementById('height-control');
        const fontControl = document.getElementById('font-control');
        const widthDisplay = document.getElementById('width-display');
        const heightDisplay = document.getElementById('height-display');
        const fontDisplay = document.getElementById('font-display');
        const pagesContainer = document.getElementById('pages-container');
        const notification = document.getElementById('notification');

        // Template for a new tag
        const tagTemplate = `
            <div class="tag">
                <div class="delete-btn">Ã—</div>
                <img class="logo" src="https://i.ibb.co/m5kn0Shy/forchetta-without-background-logo.png" alt="Forchetta Logo">
                <div class="accent-bar"></div>
                <div class="food-name" contenteditable="true">NEW ITEM</div>
            </div>
        `;

        // Template for a new page
        const pageTemplate = `
            <div class="page">
                ${tagTemplate.repeat(8)}
            </div>
        `;

        // Initialize with one page
        addNewPage();

        // Update tag sizes when controls change
        widthControl.addEventListener('input', updateSizes);
        heightControl.addEventListener('input', updateSizes);
        fontControl.addEventListener('input', updateFontSizes);

        function showNotification() {
            notification.style.opacity = 1;
            setTimeout(() => {
                notification.style.opacity = 0;
            }, 2000);
        }

        function updateSizes() {
            const width = widthControl.value;
            const height = heightControl.value;
            
            widthDisplay.textContent = `${width}mm`;
            heightDisplay.textContent = `${height}mm`;
            
            document.querySelectorAll('.tag').forEach(tag => {
                tag.style.width = `${width}mm`;
                tag.style.height = `${height}mm`;
            });
        }

        function updateFontSizes() {
            const fontSize = fontControl.value;
            fontDisplay.textContent = `${fontSize}mm`;
            
            document.querySelectorAll('.food-name').forEach(name => {
                name.style.fontSize = `${fontSize}mm`;
            });
        }

        function resetSizes() {
            widthControl.value = 90;
            heightControl.value = 60;
            fontControl.value = 10;
            updateSizes();
            updateFontSizes();
        }

        function printTags() {
            document.querySelector('.controls').style.display = 'none';
            window.print();
            setTimeout(() => {
                document.querySelector('.controls').style.display = 'flex';
            }, 1000);
        }

        function addNewPage() {
            const newPage = document.createElement('div');
            newPage.innerHTML = pageTemplate;
            pagesContainer.appendChild(newPage);
            updateSizes();
            updateFontSizes();
            setupTagDeletion(newPage);
        }

        function removeCurrentPage() {
            const pages = document.querySelectorAll('.page');
            if (pages.length > 1) {
                pages[pages.length - 1].remove();
            } else {
                alert("You need to keep at least one page.");
            }
        }

        function setupTagDeletion(page) {
            const deleteButtons = page.querySelectorAll('.delete-btn');
            deleteButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const tag = this.closest('.tag');
                    tag.remove();
                    reorganizeTags();
                    showNotification();
                });
            });
        }

        function reorganizeTags() {
            const allTags = Array.from(document.querySelectorAll('.tag'));
            const pages = document.querySelectorAll('.page');
            
            // Clear all tags from pages
            pages.forEach(page => {
                const tagsInPage = page.querySelectorAll('.tag');
                tagsInPage.forEach(tag => tag.remove());
            });
            
            // Redistribute tags evenly across pages
            let currentPageIndex = 0;
            let tagsInCurrentPage = 0;
            
            allTags.forEach((tag, index) => {
                if (tagsInCurrentPage >= 8) {
                    currentPageIndex++;
                    tagsInCurrentPage = 0;
                    
                    // Add new page if needed
                    if (!pages[currentPageIndex]) {
                        addNewPage();
                        pages = document.querySelectorAll('.page'); // Refresh pages list
                    }
                }
                
                pages[currentPageIndex].appendChild(tag);
                tagsInCurrentPage++;
            });
            
            // Remove empty pages (except one)
            const emptyPages = Array.from(pages).filter(page => {
                return page.querySelectorAll('.tag').length === 0;
            });
            
            emptyPages.forEach((page, index) => {
                if (document.querySelectorAll('.page').length > 1 && index < emptyPages.length - 1) {
                    page.remove();
                }
            });
            
            // Reattach delete handlers to all tags
            document.querySelectorAll('.page').forEach(page => {
                setupTagDeletion(page);
            });
        }

        function exportToJson() {
            const pages = Array.from(document.querySelectorAll('.page')).map(page => {
                return Array.from(page.querySelectorAll('.tag')).map(tag => {
                    return {
                        foodName: tag.querySelector('.food-name').textContent
                    };
                });
            });
            
            const data = {
                width: widthControl.value,
                height: heightControl.value,
                fontSize: fontControl.value,
                pages: pages
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'food-tags.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function importFromJson(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Clear existing pages
                    pagesContainer.innerHTML = '';
                    
                    // Apply settings
                    widthControl.value = data.width || 90;
                    heightControl.value = data.height || 60;
                    fontControl.value = data.fontSize || 10;
                    updateSizes();
                    updateFontSizes();
                    
                    // Create pages and tags
                    data.pages.forEach(pageData => {
                        const newPage = document.createElement('div');
                        newPage.innerHTML = pageTemplate;
                        
                        // Update tags with saved data
                        const tags = newPage.querySelectorAll('.tag');
                        pageData.forEach((tagData, index) => {
                            if (index < tags.length) {
                                tags[index].querySelector('.food-name').textContent = tagData.foodName || 'NEW ITEM';
                            }
                        });
                        
                        pagesContainer.appendChild(newPage);
                        setupTagDeletion(newPage);
                    });
                    
                    // If no pages were loaded, add one
                    if (data.pages.length === 0) {
                        addNewPage();
                    }
                } catch (error) {
                    alert('Error loading JSON file: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Initialize tag deletion for existing pages
        document.querySelectorAll('.page').forEach(page => {
            setupTagDeletion(page);
        });
    </script>
</body>
</html>
